================================================================================
INSTRUÃ‡Ã•ES FRONTEND - QR CODE E GESTÃƒO DE MESAS
================================================================================
Data: 21 de Fevereiro de 2026
Sistema: GestÃ£o de RestauraÃ§Ã£o
MÃ³dulo: QR Code + VisÃ£o de Mesas

================================================================================
1. ENDPOINTS QR CODE
================================================================================

1.1. GERAR QR CODE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
POST /api/qrcode
Authorization: Bearer {token}
Roles: ATENDENTE, GERENTE, ADMIN

REQUEST:
{
  "tipo": "MESA",                    // MESA | ENTREGA | PAGAMENTO
  "unidadeDeConsumoId": 10,          // ObrigatÃ³rio para tipo MESA
  "pedidoId": null,                  // ObrigatÃ³rio para ENTREGA/PAGAMENTO
  "validadeMinutos": 1440,           // Opcional (default: 60 min)
  "metadados": null                  // Opcional
}

RESPONSE (201 Created):
{
  "success": true,
  "message": "QR Code gerado com sucesso",
  "data": {
    "id": 1,
    "token": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",    // â† Apenas token
    "tipo": "MESA",
    "status": "ATIVO",
    "expiraEm": "2026-02-22T13:00:00",
    "unidadeDeConsumoId": 10,
    "unidadeDeConsumoNome": "Mesa 15",
    "url": "http://localhost:8080/api/qrcode/validar/a1b2c3d4...",
    "valido": true,
    "expirado": false,
    "criadoEm": "2026-02-21T13:00:00",
    "criadoPor": "admin"
  }
}

IMPORTANTE: Response NÃƒO contÃ©m imagem base64 (performance)
Payload: ~200 bytes apenas

TIPOS DE QR CODE:
- MESA: QR Code permanente de mesa (validade longa, renovÃ¡vel)
- ENTREGA: QR Code para confirmaÃ§Ã£o de entrega de SubPedido
- PAGAMENTO: QR Code para pagamento de pedido especÃ­fico

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1.2. BUSCAR QR CODE DA UNIDADE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
GET /api/qrcode/unidade-consumo/{id}
Authorization: Bearer {token}

RESPONSE:
{
  "success": true,
  "data": [
    {
      "id": 1,
      "token": "a1b2c3d4...",
      "tipo": "MESA",
      "status": "ATIVO",
      "url": "http://localhost:8080/api/qrcode/validar/a1b2c3d4..."
    }
  ]
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1.3. OBTER IMAGEM PNG (ENDPOINT SEPARADO)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
GET /api/qrcode/imagem/{token}

RESPONSE: image/png (300x300 px, ~5KB)
Content-Type: image/png
Cache-Control: public, max-age=86400

USAR NO HTML (lazy loading automÃ¡tico):
<img src="/api/qrcode/imagem/{token}" alt="QR Code" loading="lazy" />

Download para impressÃ£o (500x500 px, alta resoluÃ§Ã£o):
GET /api/qrcode/imagem/{token}/print

VANTAGENS DESTA ABORDAGEM:
âœ“ Response leve (~200 bytes vs 7KB+ se fosse base64)
âœ“ Cache HTTP automÃ¡tico (navegador + CDN)
âœ“ Lazy loading (sÃ³ carrega se visÃ­vel)
âœ“ MÃºltiplos tamanhos disponÃ­veis

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1.4. VALIDAR QR CODE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
GET /api/qrcode/validar/{token}

RESPONSE:
{
  "success": true,
  "data": {
    "valido": true,
    "mensagem": "QR Code vÃ¡lido",
    "qrCode": { ... }
  }
}

Se invÃ¡lido:
{
  "valido": false,
  "mensagem": "QR Code expirado",
  "motivoInvalido": "EXPIRADO"  // NAO_ENCONTRADO | EXPIRADO | USADO | CANCELADO
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1.5. RENOVAR QR CODE (APENAS MESA)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
POST /api/qrcode/renovar/{token}
Authorization: Bearer {token}

Estende validade por mais 60 minutos (ou padrÃ£o configurado)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1.6. CANCELAR QR CODE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
DELETE /api/qrcode/{token}
Authorization: Bearer {token}
Roles: GERENTE, ADMIN

================================================================================
2. CENÃRIOS DE USO DO QR CODE
================================================================================

2.1. QR CODE DE MESA (PERMANENTE)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
OBJETIVO:
- Cliente escaneia QR Code fixo na mesa
- Acessa cardÃ¡pio digital
- Faz pedidos diretamente (self-service)

FLUXO:
1. Gerente gera QR Code para mesa
2. Imprime e cola na mesa fÃ­sica
3. Cliente escaneia â†’ redireciona para cardÃ¡pio
4. Cliente cria conta/login â†’ vincula Ã  mesa
5. Cliente faz pedidos sem chamar atendente

IMPLEMENTAÃ‡ÃƒO:
// Ao criar unidade de consumo, gerar QR Code automaticamente
const criarMesaComQrCode = async (data) => {
  // 1. Criar unidade
  const unidade = await api.post('/api/unidades-consumo', data)
  
  // 2. Gerar QR Code (retorna apenas token, NÃƒO imagem)
  const qrCode = await api.post('/api/qrcode', {
    tipo: 'MESA',
    unidadeDeConsumoId: unidade.data.data.id,
    validadeMinutos: 525600  // 1 ano
  })
  
  const token = qrCode.data.data.token  // â† Apenas string UUID
  
  // 3. Atualizar unidade com token
  await api.put(`/api/unidades-consumo/${unidade.data.data.id}`, {
    qrCode: token
  })
  
  // 4. URL da imagem (carregamento separado, lazy)
  const imagemUrl = `/api/qrcode/imagem/${token}`
  
  return { unidade, qrCode: { ...qrCode.data.data, imagemUrl } }
}
           â”‚  [Renovar] [Baixar] â”‚
â”‚ â”‚ <img src=   â”‚                     â”‚
â”‚ â”‚ "/api/qr... â”‚                     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚ Token: a1b2c3d4...                  â”‚
â”‚ Expira: 22/02/2027 13:00            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CÃ“DIGO HTML:
<img 
  src={`/api/qrcode/imagem/${token}`}
  alt="QR Code Mesa 15"
  loading="lazy"
  width="300"
  height="300"
/>
â”‚ â”‚   IMAGEM    â”‚                     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚ Token: a1b2c3d4...                  â”‚
â”‚ Expira: 22/02/2027 13:00            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2.2. QR CODE DE ENTREGA (USO ÃšNICO)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
OBJETIVO:
- Atendente escaneia para confirmar entrega de SubPedido
- Garante que item foi entregue na mesa correta
- Rastreabilidade (quem/quando entregou)

FLUXO:
1. SubPedido fica PRONTO na cozinha
2. Sistema gera QR Code de entrega (vÃ¡lido 15 min)
3. Atendente pega pedido + escaneia QR Code
4. Sistema marca SubPedido como ENTREGUE
5. Registra quem entregou

IMPLEMENTAÃ‡ÃƒO:
// Ao SubPedido ficar PRONTO
const gerarQrCodeEntrega = async (subPedidoId) => {
  const qrCode = await api.post('/api/qrcode', {
    tipo: 'ENTREGA',
    pedidoId: subPedidoId,
    validadeMinutos: 15
  })
  
  // Exibir modal com QR Code para atendente escanear
  return qrCode.data.data
}

// Ao escanear
const confirmarEntrega = async (token) => {
  // Valida QR Code
  const validacao = await api.get(`/api/qrcode/validar/${token}`)
  
  if (!validacao.data.data.valido) {
    alert('QR Code invÃ¡lido ou expirado')
    return
  }
  
  // Marca como usado
  await api.post(`/api/qrcode/usar/${token}`)
  
  // Atualiza status SubPedido
  const pedidoId = validacao.data.data.qrCode.pedidoId
  await api.put(`/api/subpedidos/${pedidoId}/entregar`)
}

2.3. QR CODE DE PAGAMENTO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
OBJETIVO:
- Cliente escaneia para pagar conta
- Redireciona para gateway de pagamento
- ConfirmaÃ§Ã£o automÃ¡tica apÃ³s pagamento

FLUXO:
1. Cliente solicita conta
2. Sistema gera QR Code com link de pagamento
3. Cliente escaneia â†’ redireciona para AppyPay
4. Cliente paga
5. Webhook atualiza status do pedido

IMPLEMENTAÃ‡ÃƒO:
const gerarQrCodePagamento = async (pedidoId) => {
  const qrCode = await api.post('/api/qrcode', {
    tipo: 'PAGAMENTO',
    pedidoId: pedidoId,
    validadeMinutos: 60
  })
  
  // URL jÃ¡ contÃ©m link para pagamento
  return qrCode.data.data
}

================================================================================
3. PÃGINA DE GESTÃƒO DE MESAS
================================================================================

3.1. LAYOUT - VISÃƒO GERAL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ENDPOINT PRINCIPAL:
GET /api/unidades-consumo/minhas

Retorna todas as mesas da UnidadeAtendimento do usuÃ¡rio logado

LAYOUT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GestÃ£o de Mesas - Restaurante Principal                               â”‚
â”‚ 12 mesas abertas | 8 mesas livres                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Filtros]  Status: [Todas â–¼]  Tipo: [Todas â–¼]  [ğŸ” Buscar...]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Mesa 10  [â€¢]   â”‚  â”‚ Mesa 15  [â€¢]   â”‚  â”‚ Mesa 20  [â—‹]   â”‚         â”‚
â”‚  â”‚ JoÃ£o Silva     â”‚  â”‚ Maria Santos   â”‚  â”‚ DISPONÃVEL     â”‚         â”‚
â”‚  â”‚ 25.000,00 Kz   â”‚  â”‚ 30.000,00 Kz   â”‚  â”‚                â”‚         â”‚
â”‚  â”‚ 2 pedido(s)    â”‚  â”‚ 1 pedido(s)    â”‚  â”‚ 4 pessoas      â”‚         â”‚
â”‚  â”‚ [Abrir]        â”‚  â”‚ [Abrir]        â”‚  â”‚ [Ocupar]       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CORES DOS BADGES:
[â€¢] Verde   - OCUPADA
[â€¢] Amarelo - AGUARDANDO_PAGAMENTO  
[â€¢] Cinza   - FINALIZADA
[â—‹] Azul    - DISPONÃVEL

3.2. CARDS DE MESA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

MESA OCUPADA:
{
  "id": 10,
  "referencia": "Mesa 10",
  "status": "OCUPADA",
  "tipo": "MESA_FISICA",
  "numero": 10,
  "capacidade": 4,
  "cliente": {
    "id": 50,
    "nome": "JoÃ£o Silva",
    "telefone": "+244923456789",
    "email": "joao@email.com"
  },
  "pedidos": [
    {
      "id": 101,
      "status": "EM_ANDAMENTO",
      "total": 15000.00,
      "criadoEm": "2026-02-21T12:00:00"
    },
    {
      "id": 102,
      "status": "FINALIZADO",
      "total": 10000.00,
      "criadoEm": "2026-02-21T12:30:00"
    }
  ],
  "total": 25000.00,
  "abertaEm": "2026-02-21T11:30:00"
}

MESA DISPONÃVEL:
{
  "id": 20,
  "referencia": "Mesa 20",
  "status": "DISPONIVEL",
  "capacidade": 4,
  "cliente": null,
  "pedidos": [],
  "total": 0.00
}

================================================================================
4. MODAL DE DETALHES DA MESA
================================================================================

4.1. ABERTURA DO MODAL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

TRIGGER: Clicar no card da mesa ocupada

ENDPOINTS NECESSÃRIOS:
1. GET /api/unidades-consumo/{id} - Detalhes da mesa
2. GET /api/fundos/cliente/{clienteId} - Fundo de consumo
3. GET /api/config/pos-pago - ConfiguraÃ§Ã£o global de pÃ³s-pago

4.2. LAYOUT DO MODAL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Mesa 10 - SalÃ£o Principal                                      [X]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚ â”Œâ”€ CLIENTE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Nome: JoÃ£o Silva                                               â”‚  â”‚
â”‚ â”‚ Telefone: +244 923 456 789                                     â”‚  â”‚
â”‚ â”‚ Email: joao@email.com                                          â”‚  â”‚
â”‚ â”‚ Cliente desde: 15/01/2026                                      â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚ â”Œâ”€ FUNDO DE CONSUMO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Saldo DisponÃ­vel: 50.000,00 Kz            [ğŸ’° Recarregar]     â”‚  â”‚
â”‚ â”‚ Modo: PRÃ‰-PAGO (DÃ©bito AutomÃ¡tico)                            â”‚  â”‚
â”‚ â”‚ Total Recarregado: 100.000,00 Kz                              â”‚  â”‚
â”‚ â”‚ Total Consumido: 50.000,00 Kz                                 â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚ â”Œâ”€ CONTA DA MESA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Total Consumido: 25.000,00 Kz                                  â”‚  â”‚
â”‚ â”‚ Total Pago: 25.000,00 Kz                                       â”‚  â”‚
â”‚ â”‚ Total Pendente: 0,00 Kz                                        â”‚  â”‚
â”‚ â”‚ Aberta desde: 21/02/2026 11:30 (1h 30min)                     â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚ â”Œâ”€ HISTÃ“RICO DE PEDIDOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚                                                                 â”‚  â”‚
â”‚ â”‚ [Todos] [Abertos] [Finalizados] [Cancelados]                  â”‚  â”‚
â”‚ â”‚                                                                 â”‚  â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚ â”‚ â”‚ Pedido #101 | 21/02 12:00 | EM_ANDAMENTO    | 15.000 Kzâ”‚   â”‚  â”‚
â”‚ â”‚ â”‚ â€¢ 2x Bife Grelhado (Em preparaÃ§Ã£o)                      â”‚   â”‚  â”‚
â”‚ â”‚ â”‚ â€¢ 1x Batata Frita (Pronto para entrega)                 â”‚   â”‚  â”‚
â”‚ â”‚ â”‚ Status Financeiro: PAGO (PRÃ‰-PAGO)                      â”‚   â”‚  â”‚
â”‚ â”‚ â”‚ [Ver Detalhes]                                           â”‚   â”‚  â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚ â”‚                                                                 â”‚  â”‚
â”‚ â”‚ <img src="/api/qrcode/imagem/{token}"                         â”‚  â”‚
â”‚ â”‚      loading="lazy" width="300" height="300" />               â”‚  â”‚
â”‚ â”‚                                                                 â”‚  â”‚
â”‚ â”‚ [Renovar] [Baixar 500x500] [Cancelar]                   â”‚   â”‚  â”‚
â”‚ â”‚ â”‚ [Ver Detalhes]                                           â”‚   â”‚  â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚ â”‚                                                                 â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚ â”Œâ”€ QR CODE DA MESA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚  â”‚
â”‚ â”‚ â”‚ QR  CODE  â”‚  [Renovar] [Baixar para ImpressÃ£o] [Cancelar]   â”‚  â”‚
â”‚ â”‚ â”‚  IMAGEM   â”‚                                                   â”‚  â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚  â”‚
â”‚ â”‚ Expira: 22/02/2027 13:00                                       â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚ [Novo Pedido] [Fechar Mesa] [Imprimir Conta]             [Fechar] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4.3. DADOS DO MODAL - ESTRUTURA COMPLETA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

const carregarDetalhesMesa = async (mesaId) => {
  // 1. Detalhes da mesa
  const mesa = await api.get(`/api/unidades-consumo/${mesaId}`)
  
  // 2. Fundo de consumo do cliente
  const clienteId = mesa.data.data.cliente.id
  const fundo = await api.get(`/api/fundos/cliente/${clienteId}`)
  
  // 3. QR Code da mesa
  const qrCodes = await api.get(`/api/qrcode/unidade-consumo/${mesaId}`)
  
  return {
    mesa: mesa.data.data,
    fundo: fundo.data.data,
    qrCode: qrCodes.data.data[0] // Primeiro QR Code ativo
  }
}

ESTRUTURA FUNDO DE CONSUMO:
{
  "id": 1,
  "cliente": {
    "id": 50,
    "nome": "JoÃ£o Silva"
  },
  "saldo": 50000.00,
  "totalRecarregado": 100000.00,
  "totalConsumido": 50000.00,
  "ativo": true,
  "criadoEm": "2026-01-15T10:00:00",
  "version": 5
}

4.4. CÃLCULOS NO FRONTEND
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

// Total consumido da mesa
const totalConsumido = mesa.pedidos.reduce((acc, p) => acc + p.total, 0)

// Total pago (apenas pedidos com statusFinanceiro = PAGO)
const totalPago = mesa.pedidos
  .filter(p => p.statusFinanceiro === 'PAGO')
  .reduce((acc, p) => acc + p.total, 0)

// Total pendente
const totalPendente = totalConsumido - totalPago

// Modo de pagamento (verifica primeiro pedido)
const modo = mesa.pedidos[0]?.tipoPagamento === 'PRE_PAGO' 
  ? 'PRÃ‰-PAGO (DÃ©bito AutomÃ¡tico)' 
  : 'PÃ“S-PAGO (Pagar no Final)'

// Tempo aberto
const tempoAberto = calcularTempoDecorrido(mesa.abertaEm, new Date())

4.5. DETECÃ‡ÃƒO DE MODO PRÃ‰-PAGO vs PÃ“S-PAGO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

REGRA:
- PRÃ‰-PAGO: Cliente TEM Fundo de Consumo ativo
- PÃ“S-PAGO: Cliente NÃƒO TEM Fundo de Consumo (paga no final)

const detectarModo = (fundo) => {
  if (!fundo || !fundo.ativo) {
    return {
      modo: 'PÃ“S-PAGO',
      descricao: 'Pagamento manual no final',
      icon: 'ğŸ’³',
      color: 'orange'
    }
  }
  
  return {
    modo: 'PRÃ‰-PAGO',
    descricao: 'DÃ©bito automÃ¡tico do Fundo de Consumo',
    icon: 'ğŸ’°',
    color: 'green'
  }
}

EXIBIÃ‡ÃƒO:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’° PRÃ‰-PAGO (DÃ©bito AutomÃ¡tico)         â”‚
â”‚ Saldo: 50.000,00 Kz                     â”‚
â”‚ [Recarregar Fundo]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ou

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’³ PÃ“S-PAGO (Pagamento Manual)          â”‚
â”‚ Total a Pagar: 25.000,00 Kz             â”‚
â”‚ [Processar Pagamento]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
5. INTEGRAÃ‡ÃƒO COMPLETA - FLUXO DE TRABALHO
================================================================================

5.1. CRIAR MESA COM QR CODE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

const criarMesa = async (dadosMesa) => {
  try {
    // 1. Criar unidade de consumo
    const unidadeResponse = await api.post('/api/unidades-consumo', {
      referencia: dadosMesa.referencia,
      tipo: 'MESA_FISICA',
      numero: dadosMesa.numero,
      capacidade: dadosMesa.capacidade,
      telefoneCliente: dadosMesa.telefoneCliente,
      unidadeAtendimentoId: dadosMesa.unidadeAtendimentoId,
      atendenteId: getUserId() // Se criada manualmente
    })
    
    const unidade = unidadeResponse.data.data
    
    // 2. Gerar QR Code (permanente, 1 ano)
    const qrCodeResponse = await api.post('/api/qrcode', {
      tipo: 'MESA',
      unidadeDeConsumoId: unidade.id,
      validadeMinutos: 525600 // 365 dias
    })
    
    const qrCode = qrCodeResponse.data.data
    
    // 3. Baixar imagem para impressÃ£o
    const imagemUrl = `/api/qrcode/imagem/${qrCode.token}/print`
    
    // 4. Exibir sucesso com QR Code
    showSuccessModal({
      titulo: `Mesa ${unidade.referencia} criada!`,
      mensagem: 'QR Code gerado com sucesso',
      qrCodeImagem: imagemUrl,
      acoes: [
        { label: 'Baixar QR Code', action: () => downloadQrCode(imagemUrl) },
        { label: 'Imprimir', action: () => printQrCode(imagemUrl) },
        { label: 'Fechar', action: () => closeModal() }
      ]
    })
    
    // 5. Atualizar lista de mesas
    await refreshMesas()
    
    return { unidade, qrCode }
    
  } catch (error) {
    showError('Erro ao criar mesa: ' + error.message)
  }
}

5.2. ABRIR MODAL DE DETALHES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

const abrirDetalhes Mesa = async (mesaId) => {
  showLoading()
  
  try {
    // Buscar todos os dados em paralelo
    const [mesaRes, qrCodesRes] = await Promise.all([
      api.get(`/api/unidades-consumo/${mesaId}`),
      api.get(`/api/qrcode/unidade-consumo/${mesaId}`)
    ])
    
    const mesa = mesaRes.data.data
    const qrCode = qrCodesRes.data.data[0]
    
    // Buscar fundo de consumo se cliente tem
    let fundo = null
    if (mesa.cliente?.id) {
      const fundoRes = await api.get(`/api/fundos/cliente/${mesa.cliente.id}`)
      fundo = fundoRes.data.data
    }
    
    // Calcular totais
    const totalConsumido = calcularTotalConsumido(mesa.pedidos)
    const totalPago = calcularTotalPago(mesa.pedidos)
    const totalPendente = totalConsumido - totalPago
    
    // Detectar modo
    const modo = detectarModo(fundo)
    
    // Abrir modal
    showModal('DetalheMesaModal', {
      mesa,
      fundo,
      qrCode,
      totais: { totalConsumido, totalPago, totalPendente },
      modo
    })
    
  } catch (error) {
    showError('Erro ao carregar detalhes da mesa')
  } finally {
    hideLoading()
  }
}

5.3. RECARREGAR FUNDO DE CONSUMO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

const recarregarFundo = async (fundoId, valor) => {
  try {
    // Inicia recarga via AppyPay
    const response = await api.post(`/api/fundos/${fundoId}/recarregar`, {
      valor: valor,
      metodo: 'GPO' // ou 'REF'
    })
    
    const pagamento = response.data.data
    
    // Redireciona para AppyPay ou exibe referÃªncia
    if (pagamento.metodo === 'GPO') {
      window.open(pagamento.urlPagamento, '_blank')
    } else {
      showReferenciaPagamento(pagamento.referencia)
    }
    
    // Aguarda webhook confirmar pagamento
    // Frontend deve fazer polling ou usar WebSocket
    
  } catch (error) {
    showError('Erro ao recarregar fundo')
  }
}

5.4. FECHAR MESA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

const fecharMesa = async (mesaId) => {
  try {
    // Validar: todos pedidos pagos?
    const mesa = await api.get(`/api/unidades-consumo/${mesaId}`)
    const totalPendente = calcularTotalPendente(mesa.data.data.pedidos)
    
    if (totalPendente > 0) {
      const confirmar = await showConfirm(
        'Existe valor pendente de ' + formatMoney(totalPendente) + '. Confirma fechamento?'
      )
      if (!confirmar) return
    }
    
    // Fechar
    await api.put(`/api/unidades-consumo/${mesaId}/fechar`)
    
    showSuccess('Mesa fechada com sucesso')
    closeModal()
    await refreshMesas()
    
  } catch (error) {
    showError('Erro ao fechar mesa')
  }
}

================================================================================
6. COMPONENTES UI SUGERIDOS
================================================================================

6.1. CARD DE MESA (COMPONENTE)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

<CardMesa>
  Props:
  - mesa: UnidadeConsumoResponse
  - onOpen: () => void
  
  Estado:
  - badge: status da mesa (cor e texto)
  - cliente: nome ou "DISPONÃVEL"
  - total: valor consumido ou capacidade
  - pedidos: contador de pedidos
  
  AÃ§Ãµes:
  - onClick â†’ abrirDetalhesMesa()
  - BotÃ£o "Ocupar" (se disponÃ­vel)
  - BotÃ£o "Abrir" (se ocupada)

6.2. MODAL DE DETALHES (COMPONENTE)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

<ModalDetalhesMesa>
  Props:
  - mesaId: Long
  - onClose: () => void
  
  SeÃ§Ãµes:
  1. InfoCliente
  2. InfoFundoConsumo (se PRE_PAGO)
  3. ContaMesa (totais)
  4. HistoricoPedidos (lista com filtros)
  5. QrCodeMesa (imagem + aÃ§Ãµes)
  
  AÃ§Ãµes:
  - Novo Pedido
  - Fechar Mesa
  - Imprimir Conta
  - Recarregar Fundo

6.3. FILTROS (COMPONENTE)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

<FiltrosMesas>
  Props:
  - onChange: (filters) => void
  
  Filtros:
  - Status: Todas | Ocupadas | DisponÃ­veis | Aguardando Pagamento
  - Tipo: Todas | Mesa | Quarto | Ãrea Evento | Lounge | Virtual
  - Busca: Por referÃªncia ou nome do cliente
  
  Estado:
  - filtrosAtivos: objeto com filtros selecionados

================================================================================
7. WEBSOCKET - ATUALIZAÃ‡Ã•ES EM TEMPO REAL
================================================================================

7.1. TÃ“PICOS RELEVANTES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CONECTAR:
const socket = new SockJS('http://localhost:8080/api/ws')
const stompClient = Stomp.over(socket)

INSCREVER-SE:
// NotificaÃ§Ãµes de pedidos da unidade de atendimento
stompClient.subscribe('/topic/atendente/unidade/1', (message) => {
  const notificacao = JSON.parse(message.body)
  
  if (notificacao.tipo === 'SUBPEDIDO_PRONTO') {
    // Atualizar card da mesa
    refreshMesa(notificacao.unidadeDeConsumoId)
    showToast('Pedido pronto na Mesa ' + notificacao.mesaNumero)
  }
  
  if (notificacao.tipo === 'NOVO_PEDIDO') {
    // Nova mesa ocupada
    refreshMesas()
  }
})

7.2. EVENTOS IMPORTANTES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

- MESA_OCUPADA: Nova mesa aberta
- NOVO_PEDIDO: Cliente fez pedido
- SUBPEDIDO_PRONTO: Item pronto para entrega
- SUBPEDIDO_ENTREGUE: Item entregue
- PAGAMENTO_RECEBIDO: Pagamento confirmado
- MESA_FECHADA: Mesa liberada

================================================================================
8. PERMISSÃ•ES POR ROLE
================================================================================

8.1. ADMIN
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ“ Ver TODAS as mesas (visÃ£o global)
âœ“ Abrir detalhes de qualquer mesa
âœ“ Criar/editar/excluir mesas
âœ“ Gerar/renovar/cancelar QR Codes
âœ“ Fechar qualquer mesa
âœ“ Processar pagamentos

8.2. GERENTE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ“ Ver mesas da SUA UnidadeAtendimento
âœ“ Abrir detalhes de mesas da sua unidade
âœ“ Criar/editar mesas da sua unidade
âœ“ Gerar/renovar QR Codes
âœ“ Fechar mesas da sua unidade
âœ“ Processar pagamentos

8.3. ATENDENTE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ“ Ver mesas da SUA UnidadeAtendimento
âœ“ Abrir detalhes (somente leitura)
âœ“ Criar novas mesas
âœ“ Confirmar entregas (QR Code)
âœ— NÃƒO pode fechar mesas
âœ— NÃƒO pode cancelar QR Codes

8.4. CLIENTE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ“ Ver apenas SUA mesa ativa
âœ“ Fazer pedidos
âœ“ Ver histÃ³rico de pedidos
âœ“ Ver saldo do fundo
âœ— NÃƒO pode ver outras mesas

================================================================================
9. VALIDAÃ‡Ã•ES E REGRAS DE NEGÃ“CIO
================================================================================

9.1. CRIAR MESA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ“ ReferÃªncia Ã© obrigatÃ³ria
âœ“ Telefone do cliente Ã© obrigatÃ³rio (formato: +244XXXXXXXXX)
âœ“ UnidadeAtendimentoId Ã© obrigatÃ³ria
âœ“ Cliente pode ter apenas UMA mesa ativa por vez
âœ“ Status inicial sempre = OCUPADA

9.2. FECHAR MESA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ“ Verificar se hÃ¡ valor pendente
âœ“ Confirmar com usuÃ¡rio se hÃ¡ pendÃªncias
âœ“ Todos pedidos devem estar FINALIZADOS
âœ“ Status deve ser AGUARDANDO_PAGAMENTO ou OCUPADA
âœ“ ApÃ³s fechar: status = FINALIZADA

9.3. GERAR QR CODE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ“ Tipo MESA: unidadeDeConsumoId Ã© obrigatÃ³rio
âœ“ Tipo ENTREGA/PAGAMENTO: pedidoId Ã© obrigatÃ³rio
âœ“ Validade padrÃ£o: 60 minutos (tipo MESA)
âœ“ Validade padrÃ£o: 15 minutos (tipo ENTREGA)
âœ“ Validade padrÃ£o: 60 minutos (tipo PAGAMENTO)
âœ“ Apenas um QR Code ATIVO por mesa

================================================================================
10. TRATAMENTO DE ERROS
================================================================================

400 - "Cliente jÃ¡ possui uma unidade ativa"
      â†’ Informar que cliente precisa fechar mesa anterior

400 - "QR Code jÃ¡ existe para esta unidade"
      â†’ Usar endpoint de renovaÃ§Ã£o em vez de criar novo

404 - "Unidade de consumo nÃ£o encontrada"
      â†’ Mesa pode ter sido fechada/excluÃ­da

404 - "QR Code nÃ£o encontrado"
      â†’ Token invÃ¡lido ou QR Code expirado

400 - "QR Code expirado"
      â†’ Renovar QR Code ou gerar novo

401 - "UsuÃ¡rio nÃ£o autenticado"
      â†’ Redirecionar para login

403 - "Sem permissÃ£o para acessar esta mesa"
      â†’ GERENTE tentando acessar mesa de outra unidade

================================================================================
11. CHECKLIST DE IMPLEMENTAÃ‡ÃƒO
================================================================================

PÃGINA DE GESTÃƒO:
â–¡ ServiÃ§o de API (mesasService.js, qrcodeService.js)
â–¡ Componente de listagem (GestaoMesasView.vue)
â–¡ Card de mesa (CardMesa.vue)
â–¡ Filtros (FiltrosMesas.vue)
â–¡ DetecÃ§Ã£o de role (ADMIN vs GERENTE)
â–¡ Endpoint correto (/minhas vs /todas)

MODAL DE DETALHES:
â–¡ Modal de detalhes (ModalDetalhesMesa.vue)
â–¡ SeÃ§Ã£o de cliente (InfoCliente.vue)
â–¡ SeÃ§Ã£o de fundo (InfoFundoConsumo.vue)
â–¡ SeÃ§Ã£o de conta (ContaMesa.vue)
â–¡ HistÃ³rico de pedidos (HistoricoPedidos.vue)
â–¡ QR Code display (QrCodeDisplay.vue)
â–¡ IntegraÃ§Ã£o com fundos API
â–¡ DetecÃ§Ã£o PRÃ‰-PAGO vs PÃ“S-PAGO

QR CODE:
â–¡ Gerar QR Code ao criar mesa
â–¡ Exibir imagem do QR Code
â–¡ Baixar para impressÃ£o (500x500)
â–¡ Renovar QR Code expirado
â–¡ Cancelar QR Code

WEBSOCKET:
â–¡ ConexÃ£o com /api/ws
â–¡ InscriÃ§Ã£o em tÃ³picos relevantes
â–¡ AtualizaÃ§Ã£o automÃ¡tica de cards
â–¡ NotificaÃ§Ãµes toast

TESTES:
â–¡ Criar mesa com QR Code
â–¡ Abrir modal de detalhes
â–¡ Ver histÃ³rico de pedidos
â–¡ Calcular totais corretamente
â–¡ Fechar mesa
â–¡ Renovar QR Code
â–¡ Filtrar mesas

================================================================================
FIM DO DOCUMENTO
================================================================================
