================================================================================
  RESPOSTA BACKEND - ESPECIFICA√á√ÉO DE CONTAS E PAGAMENTOS
================================================================================

Data: 20 de Fevereiro de 2026
De: Equipe Backend
Para: Equipe Frontend
Refer√™ncia: SOLICITACAO_BACKEND_CONTAS.md

================================================================================
SUM√ÅRIO EXECUTIVO
================================================================================

Agradecemos pela solicita√ß√£o detalhada e organizada. Ap√≥s an√°lise completa do
c√≥digo backend, fornecemos abaixo as respostas para todas as quest√µes levantadas.

PRINCIPAIS ESCLARECIMENTOS:
- A entidade correta √© UNIDADE DE CONSUMO (n√£o "Conta")
- Estados financeiros est√£o IMPLEMENTADOS no Pedido
- Fundo de Consumo est√° vinculado ao CLIENTE
- D√©bito autom√°tico FUNCIONA no momento da cria√ß√£o do pedido
- P√≥s-pago possui INTERRUPTOR GLOBAL no sistema


================================================================================
1. ENTIDADE CONTA - RESPOSTA
================================================================================

1.1 NOME CORRETO DA ENTIDADE
-----------------------------

‚ùå N√ÉO existe entidade "Conta"
‚úÖ EXISTE entidade "UnidadeDeConsumo"

EXPLICA√á√ÉO:
O conceito que voc√™ chamou de "Conta" no frontend corresponde √† nossa entidade
"UnidadeDeConsumo". Esta √© uma abstra√ß√£o gen√©rica que representa um ponto de
consumo no sistema.

UNIDADE DE CONSUMO pode ser:
- Mesa f√≠sica de restaurante
- Quarto de hotel (room service)
- √Årea de evento
- Espa√ßo lounge
- Virtual (delivery)

CAMINHO DA ENTIDADE:
src/main/java/com/restaurante/model/entity/UnidadeDeConsumo.java


1.2 CONCEITO E RESPONSABILIDADES
---------------------------------

Uma UnidadeDeConsumo:
- Representa um ponto de consumo ativo no sistema
- SEMPRE est√° associada a um Cliente (obrigat√≥rio)
- Pode ter m√∫ltiplos Pedidos vinculados
- Possui ciclo de vida: DISPONIVEL ‚Üí OCUPADA ‚Üí AGUARDANDO_PAGAMENTO ‚Üí FINALIZADA
- Criada quando cliente escaneia QR Code OU atendente cria manualmente
- Vinculada obrigatoriamente a uma UnidadeAtendimento (restaurante, bar, etc)


1.3 DIFEREN√áAS CONCEITUAIS
---------------------------

FRONTEND (seu modelo):           BACKEND (modelo real):
‚îú‚îÄ Conta                    ‚Üí    UnidadeDeConsumo
‚îú‚îÄ identificador            ‚Üí    referencia
‚îú‚îÄ tipo (MESA/COMANDA)      ‚Üí    tipo (enum TipoUnidadeConsumo)
‚îú‚îÄ statusFinanceiro         ‚Üí    status (enum StatusUnidadeConsumo)
‚îú‚îÄ aberturaEm              ‚Üí    abertaEm
‚îú‚îÄ fechamentoEm            ‚Üí    fechadaEm
‚îú‚îÄ pedidos                 ‚Üí    pedidos (List<Pedido>)
‚îî‚îÄ fundoConsumo            ‚Üí    (indiretamente via Cliente)


================================================================================
2. ESTADOS FINANCEIROS - RESPOSTA
================================================================================

2.1 ONDE EST√ÉO OS ESTADOS FINANCEIROS?
---------------------------------------

Os estados financeiros est√£o em DUAS entidades:

A) PEDIDO - StatusFinanceiroPedido (eixo financeiro do pedido):
   - NAO_PAGO: Aguardando pagamento (p√≥s-pago)
   - PAGO: Pagamento confirmado
   - ESTORNADO: Cancelado com devolu√ß√£o

B) UNIDADE DE CONSUMO - StatusUnidadeConsumo (ciclo de vida):
   - DISPONIVEL: Livre para uso
   - OCUPADA: Em uso por cliente
   - AGUARDANDO_PAGAMENTO: Consumo finalizado, pagamento pendente
   - FINALIZADA: Pagamento conclu√≠do


2.2 NOMENCLATURA CORRETA
-------------------------

‚ùå N√ÉO use: "PAGO", "EM_DEBITO", "PARCIAL" como estados da UnidadeDeConsumo
‚úÖ USE: Os enums acima conforme a entidade

IMPORTANTE:
- StatusFinanceiroPedido √© do PEDIDO individual
- StatusUnidadeConsumo √© da UNIDADE DE CONSUMO (mesa/comanda)
- S√£o conceitos DIFERENTES e INDEPENDENTES


2.3 C√ÅLCULO DE ESTADOS
-----------------------

StatusFinanceiroPedido (PEDIDO):
- Armazenado no banco de dados
- Atualizado automaticamente ao processar pagamento
- Independente do estado operacional (StatusPedido)

StatusUnidadeConsumo (UNIDADE):
- Armazenado no banco de dados
- Atualizado conforme ciclo de vida da unidade
- N√£o √© calculado em tempo real


2.4 RESUMO FINANCEIRO DA UNIDADE
---------------------------------

Para calcular totais financeiros de uma UnidadeDeConsumo:

TOTAL CONSUMIDO:
- Soma de todos os pedidos.total da unidade

TOTAL PAGO:
- Soma dos pedidos com statusFinanceiro = PAGO

TOTAL PENDENTE:
- Soma dos pedidos com statusFinanceiro = NAO_PAGO

C√ÅLCULO NO FRONTEND:
Estes valores N√ÉO s√£o armazenados. Devem ser calculados pelo frontend
a partir da lista de pedidos retornada no response.


================================================================================
3. RELA√á√ÉO UNIDADE DE CONSUMO ‚Üî PEDIDO - RESPOSTA
================================================================================

3.1 RELACIONAMENTO CONFIRMADO
------------------------------

‚úÖ Uma UnidadeDeConsumo pode ter m√∫ltiplos Pedidos
‚úÖ Cada Pedido pertence a uma √∫nica UnidadeDeConsumo
‚úÖ Relacionamento: @OneToMany (UnidadeDeConsumo ‚Üí Pedidos)

ESTRUTURA JPA:
UnidadeDeConsumo {
    @OneToMany(mappedBy = "unidadeConsumo")
    private List<Pedido> pedidos;
}

Pedido {
    @ManyToOne
    @JoinColumn(name = "unidade_consumo_id", nullable = false)
    private UnidadeDeConsumo unidadeConsumo;
}


3.2 CICLO DE VIDA DA UNIDADE DE CONSUMO
----------------------------------------

ABERTURA:
- Cliente escaneia QR Code da mesa
- OU Atendente cria manualmente via painel
- Status inicial: OCUPADA
- Timestamp abertaEm registrado
- Cliente vinculado obrigatoriamente

DURANTE USO:
- Cliente pode fazer m√∫ltiplos pedidos
- Status permanece OCUPADA enquanto houver consumo ativo

FECHAMENTO:
- Atendente chama endpoint PUT /api/unidades-consumo/{id}/fechar
- Sistema valida se pode fechar (ver se√ß√£o 8.2)
- Status muda para FINALIZADA
- Timestamp fechadaEm registrado


================================================================================
4. FUNDO DE CONSUMO - INTEGRA√á√ÉO - RESPOSTA
================================================================================

4.1 VINCULA√á√ÉO DO FUNDO
------------------------

‚úÖ Fundo de Consumo est√° vinculado ao CLIENTE (n√£o √† UnidadeDeConsumo)

ESTRUTURA:
Cliente (1) ‚Üê‚Üí (0..1) FundoConsumo

REGRAS:
- Um Cliente pode ter UM fundo ativo por vez
- Relacionamento @OneToOne
- FundoConsumo pertence ao Cliente
- Todas as UnidadesDeConsumo do mesmo Cliente usam o mesmo fundo


4.2 D√âBITO AUTOM√ÅTICO
----------------------

‚úÖ O d√©bito √© AUTOM√ÅTICO ao criar pedido com tipoPagamento = PRE_PAGO

FLUXO T√âCNICO:
1. Frontend chama POST /api/pedidos com CriarPedidoRequest
2. Backend valida saldo suficiente no Fundo do Cliente
3. Backend cria o Pedido
4. Backend debita automaticamente o Fundo (TransacaoFundo.DEBITO)
5. Backend marca statusFinanceiro = PAGO
6. Backend retorna PedidoResponse com pedido j√° pago

IDEMPOT√äNCIA:
Se pedido j√° estiver pago, sistema ignora processamento duplicado.


4.3 CONSULTA DE FUNDO DISPON√çVEL
---------------------------------

Endpoint para consultar fundo:
GET /api/fundos-consumo/cliente/{clienteId}

Response:
{
  "success": true,
  "data": {
    "id": 1,
    "saldoAtual": 15000.00,
    "ativo": true,
    "clienteId": 123
  }
}

ALTERNATIVA (obter junto com UnidadeDeConsumo):
GET /api/unidades-consumo/{id}

Response incluir√°:
{
  "cliente": {
    "id": 123,
    "nome": "Jo√£o Silva",
    "fundoConsumo": {
      "id": 1,
      "saldoAtual": 15000.00
    }
  }
}


================================================================================
5. PAGAMENTO DE PEDIDOS - FLUXO CORRETO - RESPOSTA
================================================================================

5.1 VALIDA√á√ÉO DOS FLUXOS
-------------------------

FLUXO A - Com Fundo Suficiente (PRE_PAGO):
‚úÖ CORRETO

1. POST /api/pedidos { unidadeConsumoId, itens[], tipoPagamento: "PRE_PAGO" }
2. Backend debita automaticamente do fundo
3. Retorna pedido com statusFinanceiro = PAGO

OBSERVA√á√ïES:
- tipoPagamento √© OPCIONAL no request (default: PRE_PAGO)
- Se saldo insuficiente, retorna erro 400 com mensagem clara


FLUXO B - Sem Fundo (POS_PAGO):
‚úÖ PARCIALMENTE CORRETO (ajustes necess√°rios)

FLUXO REAL:
1. POST /api/pedidos { unidadeConsumoId, itens[], tipoPagamento: "POS_PAGO" }
2. Backend valida se p√≥s-pago est√° ATIVO globalmente
3. Backend valida se usu√°rio tem permiss√£o (GERENTE/ADMIN)
4. Backend cria pedido com statusFinanceiro = NAO_PAGO
5. Backend retorna PedidoResponse

DEPOIS, para confirmar pagamento:
6. PUT /api/pedidos/{id}/confirmar-pagamento (somente GERENTE/ADMIN)
7. Backend marca statusFinanceiro = PAGO


5.2 ENDPOINT DE PAGAMENTO
--------------------------

‚ùå N√ÉO existe: POST /api/pedidos/{id}/pagar
‚úÖ EXISTE: PUT /api/pedidos/{id}/confirmar-pagamento

IMPORTANTE:
Este endpoint confirma pagamento POS_PAGO ap√≥s pagamento presencial.
Somente GERENTE ou ADMIN podem chamar.

Request: (sem body)
PUT /api/pedidos/{id}/confirmar-pagamento
Authorization: Bearer {token_gerente}

Response:
{
  "success": true,
  "message": "Pagamento confirmado para pedido PED-100",
  "data": {
    "id": 100,
    "statusFinanceiro": "PAGO",
    "pagoEm": "2026-02-20T18:45:00"
  }
}


5.3 M√âTODOS DE PAGAMENTO
-------------------------

TipoPagamentoPedido (usado ao criar pedido):
- PRE_PAGO: D√©bito autom√°tico de Fundo de Consumo
- POS_PAGO: Pagamento posterior (requer autoriza√ß√£o)

IMPORTANTE:
- N√ÉO confundir com m√©todos de gateway (GPO, REFERENCIA, MULTICAIXA)
- M√©todos de gateway s√£o usados para RECARGA de Fundo (via AppyPay)
- No contexto de pedidos, usa-se apenas PRE_PAGO ou POS_PAGO


5.4 CAMPO ESTADO FINANCEIRO
----------------------------

‚úÖ O campo statusFinanceiro EXISTE em Pedido

VALORES:
- NAO_PAGO: Aguardando pagamento
- PAGO: Pagamento confirmado
- ESTORNADO: Cancelado com devolu√ß√£o

LOCALIZA√á√ÉO:
src/main/java/com/restaurante/model/enums/StatusFinanceiroPedido.java


================================================================================
6. ENDPOINTS NECESS√ÅRIOS - RESPOSTA
================================================================================

6.1 ENDPOINTS DE UNIDADES DE CONSUMO
-------------------------------------

BASE URL: /api/unidades-consumo

‚úÖ GET /api/unidades-consumo/status/{status}
   - Lista unidades filtradas por status
   - Params: status (DISPONIVEL, OCUPADA, AGUARDANDO_PAGAMENTO, FINALIZADA)
   - Use OCUPADA para listar "abertas"

‚úÖ GET /api/unidades-consumo/{id}
   - Detalhes completos da unidade
   - Inclui: cliente, pedidos, totais

‚úÖ POST /api/unidades-consumo
   - Criar nova unidade (abrir mesa/comanda)
   - Request: CriarUnidadeConsumoRequest
   - Body: { referencia, tipo, clienteId, unidadeAtendimentoId }

‚úÖ PUT /api/unidades-consumo/{id}/fechar
   - Fechar unidade (valida√ß√µes aplicadas)
   - Sem body

‚ùå GET /api/unidades-consumo/{id}/resumo
   - N√£o existe endpoint separado
   - Resumo vem junto no GET /api/unidades-consumo/{id}


6.2 ENDPOINTS DE PEDIDOS
-------------------------

BASE URL: /api/pedidos

‚úÖ GET /api/pedidos (listar todos)
‚úÖ POST /api/pedidos (criar pedido)
‚úÖ GET /api/pedidos/{id} (buscar por ID)
‚úÖ GET /api/pedidos/numero/{numero} (buscar por n√∫mero)
‚úÖ GET /api/pedidos/status/{status} (filtrar por status operacional)
‚úÖ PUT /api/pedidos/{id}/cancelar?motivo={motivo} (cancelar)
‚úÖ PUT /api/pedidos/{id}/confirmar-pagamento (confirmar pagamento p√≥s-pago)

‚ùå N√ÉO EXISTE: GET /api/pedidos/conta/{contaId}
‚úÖ USE: GET /api/pedidos?unidadeConsumoId={id}
   OU implemente filtro no frontend ap√≥s obter pedidos da unidade


6.3 ENDPOINTS DE PRODUTOS
--------------------------

‚úÖ GET /api/produtos (lista todos)
‚úÖ GET /api/produtos/{id} (buscar por ID)
‚úÖ GET /api/produtos/categoria/{categoriaId} (filtrar por categoria)

‚ùå N√ÉO EXISTE: GET /api/produtos/disponiveis
‚úÖ ALTERNATIVA: Filtrar disponibilidade no frontend
   (campo disponivel=true vem no response)


================================================================================
7. ESTRUTURA DE DADOS ESPERADA - RESPOSTA
================================================================================

7.1 UNIDADE DE CONSUMO RESPONSE
--------------------------------

UnidadeConsumoResponse {
  "id": 1,
  "referencia": "Mesa 10",                     // ‚Üê identificador
  "tipo": "MESA_FISICA",                       // ‚Üê TipoUnidadeConsumo enum
  "numero": 10,                                // ‚Üê n√∫mero da mesa
  "qrCode": "QR-MESA-10-ABC123",               // ‚Üê QR Code √∫nico
  "status": "OCUPADA",                         // ‚Üê StatusUnidadeConsumo enum
  "capacidade": 4,                             // ‚Üê lota√ß√£o m√°xima
  "abertaEm": "2026-02-20T18:30:00",           // ‚Üê timestamp abertura
  "fechadaEm": null,                           // ‚Üê timestamp fechamento
  "cliente": {                                 // ‚Üê cliente vinculado
    "id": 123,
    "nome": "Jo√£o Silva",
    "email": "joao@email.com",
    "telefone": "+244900000000"
  },
  "pedidos": [                                 // ‚Üê lista de pedidos
    {
      "id": 100,
      "numero": "PED-100",
      "status": "EM_ANDAMENTO",                // ‚Üê StatusPedido
      "statusFinanceiro": "PAGO",              // ‚Üê StatusFinanceiroPedido
      "total": 5000.00,
      "createdAt": "2026-02-20T18:35:00"
    }
  ],
  "total": 5000.00                             // ‚Üê soma de pedidos.total
}


7.2 CAMPOS FINANCEIROS CALCULADOS
----------------------------------

IMPORTANTE: Estes campos N√ÉO v√™m do backend.
Frontend deve calcular:

totalConsumido = soma de todos pedidos.total
totalPago = soma de pedidos onde statusFinanceiro = PAGO
totalPendente = soma de pedidos onde statusFinanceiro = NAO_PAGO

statusFinanceiroConsolidado:
- Se totalPendente = 0 ‚Üí "PAGO"
- Se totalPago = 0 ‚Üí "EM_DEBITO"
- Se totalPago > 0 E totalPendente > 0 ‚Üí "PARCIAL"


7.3 PEDIDO - CAMPOS FINANCEIROS
--------------------------------

PedidoResponse {
  "id": 101,
  "numero": "PED-101",
  "status": "ENTREGUE",                        // ‚Üê StatusPedido (operacional)
  "statusFinanceiro": "PAGO",                  // ‚Üê StatusFinanceiroPedido
  "tipoPagamento": "PRE_PAGO",                 // ‚Üê TipoPagamentoPedido
  "total": 5000.00,                            // ‚Üê valor total
  "pagoEm": "2026-02-20T18:35:00",             // ‚Üê timestamp pagamento
  "observacoes": "Pedido urgente",
  "unidadeConsumoId": 1,
  "referenciaUnidadeConsumo": "Mesa 10",
  "itens": [ ... ],
  "createdAt": "2026-02-20T18:30:00",
  "updatedAt": "2026-02-20T18:35:00"
}

‚úÖ statusFinanceiro: Existe
‚úÖ tipoPagamento: Existe
‚úÖ pagoEm: Existe
‚ùå metodoPagamento: N√£o existe no Pedido
‚ùå valorPago: Use "total" (sempre pago integralmente)


7.4 TIPOS DE DADOS
------------------

‚úÖ BigDecimal para valores monet√°rios (Kwanzas)
‚úÖ LocalDateTime para timestamps
‚úÖ statusFinanceiro √© ARMAZENADO (n√£o calculado)
‚úÖ totalConsumido/totalPago/totalPendente s√£o CALCULADOS pelo frontend
‚úÖ pedidos[] vem populado no response de UnidadeDeConsumo


================================================================================
8. REGRAS DE NEG√ìCIO - VALIDA√á√ïES - RESPOSTA
================================================================================

8.1 CRIA√á√ÉO DE PEDIDO
----------------------

‚úÖ UnidadeDeConsumo deve estar com status = OCUPADA
‚úÖ Se tipoPagamento = PRE_PAGO:
   - Valida saldo suficiente no Fundo do Cliente
   - Erro 400 se saldo insuficiente
‚úÖ Se tipoPagamento = POS_PAGO:
   - Valida se p√≥s-pago est√° ATIVO globalmente
   - Valida se usu√°rio tem role GERENTE ou ADMIN
   - Erro 403 se n√£o autorizado
   - Cria pedido com statusFinanceiro = NAO_PAGO


8.2 FECHAMENTO DE UNIDADE DE CONSUMO
-------------------------------------

VALIDA√á√ïES ATUAIS (implementadas):
‚úÖ N√£o permite se status j√° = FINALIZADA

VALIDA√á√ïES FINANCEIRAS (removidas):
‚ùå N√ÉO valida totalPendente > 0

DECIS√ÉO DE DESIGN:
A valida√ß√£o financeira foi REMOVIDA propositalmente para ser gerenciada
pelo m√≥dulo financeiro (futuro). Atualmente, frontend deve:
- Avisar se h√° pend√™ncias
- Permitir fechamento mesmo com pend√™ncias
- Gerente assume responsabilidade


8.3 PAGAMENTO DE PEDIDO
------------------------

PAGAMENTO PRE_PAGO (autom√°tico):
‚úÖ D√©bito at√¥mico do fundo
‚úÖ N√£o permite valor parcial
‚úÖ N√£o permite valor maior que total

PAGAMENTO POS_PAGO (manual):
‚úÖ Somente GERENTE/ADMIN pode confirmar
‚úÖ Marca como PAGO integralmente
‚úÖ N√£o registra m√©todo de pagamento presencial (implementa√ß√£o futura)


8.4 CANCELAMENTO DE PEDIDO
---------------------------

VALIDA√á√ïES:
‚úÖ Somente GERENTE pode cancelar
‚úÖ Motivo √© obrigat√≥rio (m√≠nimo 5 caracteres)
‚úÖ N√£o pode cancelar se status = FINALIZADO ou CANCELADO

ESTORNO AUTOM√ÅTICO:
‚úÖ Se pedido estava PAGO:
   - Se PRE_PAGO: devolve para Fundo de Consumo
   - Se POS_PAGO: apenas marca como ESTORNADO
‚úÖ statusFinanceiro muda para ESTORNADO
‚úÖ Todos SubPedidos s√£o cancelados automaticamente


================================================================================
9. POL√çTICA P√ìS-PAGO - RESPOSTA
================================================================================

9.1 CONFIGURA√á√ÉO GLOBAL
------------------------

‚úÖ P√≥s-pago possui INTERRUPTOR GLOBAL no sistema

LOCALIZA√á√ÉO:
src/main/java/com/restaurante/service/ConfiguracaoFinanceiraService.java


9.2 CONSULTA DE CONFIGURA√á√ÉO
-----------------------------

‚ùå N√ÉO EXISTE endpoint REST espec√≠fico

ALTERNATIVA 1 - Via Erro:
- Tente criar pedido POS_PAGO
- Se p√≥s-pago desabilitado, retorna erro 400:
  "P√≥s-pago est√° desabilitado no sistema"

ALTERNATIVA 2 - Via Service (backend):
- ConfiguracaoFinanceiraService.isPosPagoAtivo()
- M√©todo p√∫blico dispon√≠vel

RECOMENDA√á√ÉO:
Frontend deve assumir que p√≥s-pago est√° dispon√≠vel para GERENTE/ADMIN.
Se erro 400 retornar, exibir mensagem ao usu√°rio.


9.3 ESCOPO DA POL√çTICA
-----------------------

‚úÖ Configura√ß√£o √© GLOBAL (todo o sistema)
‚ùå N√ÉO √© por unidade
‚ùå N√ÉO √© por tipo de cliente
‚ùå N√ÉO √© por UnidadeDeConsumo


9.4 LIMITE P√ìS-PAGO
--------------------

‚úÖ Sistema possui limite p√≥s-pago: R$ 500,00 (padr√£o)

VALIDA√á√ÉO:
- Ao criar pedido POS_PAGO, valida se total de pedidos NAO_PAGO do cliente
  n√£o excede limite configurado
- Se exceder, retorna erro 400: "Limite de p√≥s-pago excedido"

C√ÅLCULO:
- Soma pedidos do Cliente com statusFinanceiro = NAO_PAGO
- Se soma + novo pedido > limite, bloqueia


================================================================================
10. AJUSTES NECESS√ÅRIOS NO FRONTEND
================================================================================

10.1 NOMENCLATURA
-----------------

SUBSTITUIR:                      POR:
‚îú‚îÄ Conta                    ‚Üí    UnidadeDeConsumo
‚îú‚îÄ contaId                  ‚Üí    unidadeConsumoId
‚îú‚îÄ identificador            ‚Üí    referencia
‚îú‚îÄ aberturaEm              ‚Üí    abertaEm
‚îú‚îÄ fechamentoEm            ‚Üí    fechadaEm


10.2 ENDPOINTS
--------------

SUBSTITUIR:                                    POR:
‚îú‚îÄ GET /api/contas/abertas                ‚Üí   GET /api/unidades-consumo/status/OCUPADA
‚îú‚îÄ GET /api/contas/{id}                   ‚Üí   GET /api/unidades-consumo/{id}
‚îú‚îÄ POST /api/contas                       ‚Üí   POST /api/unidades-consumo
‚îú‚îÄ PUT /api/contas/{id}/fechar            ‚Üí   PUT /api/unidades-consumo/{id}/fechar
‚îú‚îÄ GET /api/contas/{id}/resumo            ‚Üí   (calcular no frontend)
‚îú‚îÄ GET /api/pedidos/conta/{contaId}       ‚Üí   (filtrar pedidos da unidade)
‚îú‚îÄ POST /api/pedidos/{id}/pagar           ‚Üí   PUT /api/pedidos/{id}/confirmar-pagamento


10.3 CAMPOS FINANCEIROS
-----------------------

CALCULAR NO FRONTEND (n√£o v√™m do backend):
- totalConsumido (soma de pedidos.total)
- totalPago (soma de pedidos.total onde statusFinanceiro=PAGO)
- totalPendente (soma de pedidos.total onde statusFinanceiro=NAO_PAGO)
- statusFinanceiroConsolidado (baseado nos totais acima)


10.4 ENUMS
----------

StatusUnidadeConsumo (status da unidade):
- DISPONIVEL
- OCUPADA
- AGUARDANDO_PAGAMENTO
- FINALIZADA

StatusFinanceiroPedido (estado financeiro do pedido):
- NAO_PAGO
- PAGO
- ESTORNADO

TipoPagamentoPedido (tipo de pagamento):
- PRE_PAGO
- POS_PAGO


================================================================================
11. EXEMPLOS DE INTEGRA√á√ÉO
================================================================================

11.1 CRIAR UNIDADE DE CONSUMO (ABRIR MESA)
-------------------------------------------

Request:
POST /api/unidades-consumo
Authorization: Bearer {token}
Content-Type: application/json

{
  "referencia": "Mesa 10",
  "tipo": "MESA_FISICA",
  "numero": 10,
  "capacidade": 4,
  "clienteId": 123,
  "unidadeAtendimentoId": 1
}

Response (201):
{
  "success": true,
  "message": "Unidade de consumo criada com sucesso",
  "data": {
    "id": 50,
    "referencia": "Mesa 10",
    "tipo": "MESA_FISICA",
    "status": "OCUPADA",
    "abertaEm": "2026-02-20T19:00:00",
    "cliente": { ... }
  }
}


11.2 CRIAR PEDIDO PRE_PAGO (COM FUNDO)
---------------------------------------

Request:
POST /api/pedidos
Authorization: Bearer {token}
Content-Type: application/json

{
  "unidadeConsumoId": 50,
  "itens": [
    {
      "produtoId": 10,
      "quantidade": 2,
      "observacoes": "Sem cebola"
    }
  ],
  "tipoPagamento": "PRE_PAGO",
  "observacoes": "Pedido urgente"
}

Response (201):
{
  "success": true,
  "message": "Pedido criado com sucesso",
  "data": {
    "id": 100,
    "numero": "PED-100",
    "status": "CRIADO",
    "statusFinanceiro": "PAGO",              ‚Üê J√Å PAGO
    "tipoPagamento": "PRE_PAGO",
    "total": 5000.00,
    "pagoEm": "2026-02-20T19:05:00",
    "unidadeConsumoId": 50
  }
}


11.3 CRIAR PEDIDO POS_PAGO (SEM FUNDO)
---------------------------------------

Request:
POST /api/pedidos
Authorization: Bearer {token_gerente}
Content-Type: application/json

{
  "unidadeConsumoId": 50,
  "itens": [
    {
      "produtoId": 15,
      "quantidade": 1
    }
  ],
  "tipoPagamento": "POS_PAGO"
}

Response (201):
{
  "success": true,
  "message": "Pedido criado com sucesso",
  "data": {
    "id": 101,
    "numero": "PED-101",
    "status": "CRIADO",
    "statusFinanceiro": "NAO_PAGO",          ‚Üê N√ÉO PAGO
    "tipoPagamento": "POS_PAGO",
    "total": 3000.00,
    "pagoEm": null,
    "unidadeConsumoId": 50
  }
}


11.4 CONFIRMAR PAGAMENTO POS_PAGO
----------------------------------

Request:
PUT /api/pedidos/101/confirmar-pagamento
Authorization: Bearer {token_gerente}

Response (200):
{
  "success": true,
  "message": "Pagamento confirmado para pedido PED-101",
  "data": {
    "id": 101,
    "statusFinanceiro": "PAGO",              ‚Üê AGORA PAGO
    "pagoEm": "2026-02-20T19:30:00"
  }
}


11.5 LISTAR UNIDADES ABERTAS
-----------------------------

Request:
GET /api/unidades-consumo/status/OCUPADA
Authorization: Bearer {token}

Response (200):
{
  "success": true,
  "message": "Sucesso",
  "data": [
    {
      "id": 50,
      "referencia": "Mesa 10",
      "status": "OCUPADA",
      "cliente": { ... },
      "pedidos": [
        { "id": 100, "statusFinanceiro": "PAGO", "total": 5000.00 },
        { "id": 101, "statusFinanceiro": "PAGO", "total": 3000.00 }
      ],
      "total": 8000.00
    }
  ]
}


11.6 FECHAR UNIDADE DE CONSUMO
-------------------------------

Request:
PUT /api/unidades-consumo/50/fechar
Authorization: Bearer {token}

Response (200):
{
  "success": true,
  "message": "Unidade de consumo fechada com sucesso",
  "data": {
    "id": 50,
    "status": "FINALIZADA",                  ‚Üê FECHADA
    "fechadaEm": "2026-02-20T19:45:00"
  }
}


================================================================================
12. ERROS COMUNS E TRATAMENTO
================================================================================

12.1 ERRO: SALDO INSUFICIENTE
------------------------------

Situa√ß√£o: Criar pedido PRE_PAGO sem saldo suficiente

Response (400):
{
  "success": false,
  "message": "Saldo insuficiente. Dispon√≠vel: 1000.00, Necess√°rio: 5000.00",
  "timestamp": "2026-02-20T19:00:00"
}

A√ß√£o Frontend:
- Exibir mensagem clara ao usu√°rio
- Oferecer op√ß√£o de recarregar fundo
- OU criar pedido POS_PAGO (se GERENTE)


12.2 ERRO: P√ìS-PAGO DESABILITADO
---------------------------------

Situa√ß√£o: Criar pedido POS_PAGO com interruptor OFF

Response (400):
{
  "success": false,
  "message": "P√≥s-pago est√° desabilitado no sistema",
  "timestamp": "2026-02-20T19:00:00"
}

A√ß√£o Frontend:
- Ocultar op√ß√£o "P√≥s-Pago" no formul√°rio
- OU desabilitar bot√£o com tooltip explicativo


12.3 ERRO: P√ìS-PAGO N√ÉO AUTORIZADO
-----------------------------------

Situa√ß√£o: Cliente tenta criar pedido POS_PAGO

Response (403):
{
  "success": false,
  "message": "Apenas GERENTE ou ADMIN podem criar pedidos p√≥s-pago",
  "timestamp": "2026-02-20T19:00:00"
}

A√ß√£o Frontend:
- Verificar role do usu√°rio
- Exibir op√ß√£o POS_PAGO apenas para GERENTE/ADMIN


12.4 ERRO: LIMITE P√ìS-PAGO EXCEDIDO
------------------------------------

Situa√ß√£o: Cliente tem d√©bitos acumulados acima do limite

Response (400):
{
  "success": false,
  "message": "Limite de p√≥s-pago excedido. Limite: 50000.00, D√©bito atual: 45000.00, Tentando adicionar: 8000.00",
  "timestamp": "2026-02-20T19:00:00"
}

A√ß√£o Frontend:
- Exibir mensagem explicativa
- Sugerir pagar d√©bitos pendentes
- OU recarregar fundo


12.5 ERRO: UNIDADE N√ÉO ENCONTRADA
----------------------------------

Situa√ß√£o: ID inv√°lido de UnidadeDeConsumo

Response (404):
{
  "success": false,
  "message": "Unidade de consumo n√£o encontrada: ID 999",
  "timestamp": "2026-02-20T19:00:00"
}

A√ß√£o Frontend:
- Validar IDs antes de enviar
- Exibir erro amig√°vel ao usu√°rio


================================================================================
13. ESTRUTURA DE REQUEST
================================================================================

13.1 CriarUnidadeConsumoRequest
--------------------------------

{
  "referencia": "Mesa 10",                    // obrigat√≥rio
  "tipo": "MESA_FISICA",                      // obrigat√≥rio
  "numero": 10,                               // opcional
  "capacidade": 4,                            // opcional
  "clienteId": 123,                           // obrigat√≥rio
  "unidadeAtendimentoId": 1                   // obrigat√≥rio
}


13.2 CriarPedidoRequest
------------------------

{
  "unidadeConsumoId": 50,                     // obrigat√≥rio
  "itens": [                                  // obrigat√≥rio, min 1
    {
      "produtoId": 10,                        // obrigat√≥rio
      "quantidade": 2,                        // obrigat√≥rio, min 1
      "observacoes": "Sem cebola"             // opcional
    }
  ],
  "tipoPagamento": "PRE_PAGO",                // opcional (default: PRE_PAGO)
  "observacoes": "Pedido urgente"             // opcional
}


================================================================================
14. MIGRA√á√ÉO DO C√ìDIGO FRONTEND
================================================================================

14.1 CONTASSERVICE.JS ‚Üí UNIDADESCONSUMOSERVICE.JS
--------------------------------------------------

Renomear servi√ßo e atualizar endpoints:

ANTES:
const API_BASE = '/api/contas';

DEPOIS:
const API_BASE = '/api/unidades-consumo';


14.2 M√âTODOS DO SERVI√áO
------------------------

listarAbertas():
  GET /api/unidades-consumo/status/OCUPADA

buscarPorId(id):
  GET /api/unidades-consumo/${id}

criar(data):
  POST /api/unidades-consumo
  Body: { referencia, tipo, clienteId, unidadeAtendimentoId }

fechar(id):
  PUT /api/unidades-consumo/${id}/fechar

obterResumo(id):
  - Chamar buscarPorId(id)
  - Calcular totais no frontend


14.3 C√ÅLCULO DE RESUMO FINANCEIRO
----------------------------------

function calcularResumo(unidadeConsumo) {
  const totalConsumido = unidadeConsumo.pedidos
    .reduce((sum, p) => sum + p.total, 0);
  
  const totalPago = unidadeConsumo.pedidos
    .filter(p => p.statusFinanceiro === 'PAGO')
    .reduce((sum, p) => sum + p.total, 0);
  
  const totalPendente = unidadeConsumo.pedidos
    .filter(p => p.statusFinanceiro === 'NAO_PAGO')
    .reduce((sum, p) => sum + p.total, 0);
  
  let statusFinanceiro;
  if (totalPendente === 0) {
    statusFinanceiro = 'PAGO';
  } else if (totalPago === 0) {
    statusFinanceiro = 'EM_DEBITO';
  } else {
    statusFinanceiro = 'PARCIAL';
  }
  
  return {
    totalConsumido,
    totalPago,
    totalPendente,
    statusFinanceiro
  };
}


14.4 ATUALIZA√á√ÉO DO COMPONENTE
-------------------------------

PedidosBalcaoView.vue:

SUBSTITUIR:
- contas ‚Üí unidadesConsumo
- contaSelecionada ‚Üí unidadeSelecionada
- contasService ‚Üí unidadesConsumoService
- statusFinanceiro (prop) ‚Üí calcular localmente


================================================================================
15. DOCUMENTA√á√ÉO ADICIONAL
================================================================================

15.1 ARQUIVOS DE REFER√äNCIA
----------------------------

ENTIDADES:
- src/main/java/com/restaurante/model/entity/UnidadeDeConsumo.java
- src/main/java/com/restaurante/model/entity/Pedido.java
- src/main/java/com/restaurante/model/entity/FundoConsumo.java

ENUMS:
- src/main/java/com/restaurante/model/enums/StatusUnidadeConsumo.java
- src/main/java/com/restaurante/model/enums/StatusFinanceiroPedido.java
- src/main/java/com/restaurante/model/enums/TipoPagamentoPedido.java

CONTROLLERS:
- src/main/java/com/restaurante/controller/UnidadeDeConsumoController.java
- src/main/java/com/restaurante/controller/PedidoController.java

SERVICES:
- src/main/java/com/restaurante/service/UnidadeDeConsumoService.java
- src/main/java/com/restaurante/service/PedidoService.java
- src/main/java/com/restaurante/service/PedidoFinanceiroService.java
- src/main/java/com/restaurante/service/ConfiguracaoFinanceiraService.java


15.2 DOCUMENTA√á√ÉO EXISTENTE
----------------------------

‚úÖ INSTRUCOES_FRONTEND_PAGINA_PEDIDOS.txt
   - Estados operacionais de pedidos
   - Fluxo de SubPedidos

‚úÖ INTEGRACAO_FRONTEND_FUNDO_CONSUMO.txt
   - Recarga de fundo via AppyPay
   - Consulta de saldo

‚úÖ INSTRUCOES_FRONTEND_PAGINA_PRODUTOS.txt
   - Cat√°logo de produtos


================================================================================
16. RESUMO DAS RESPOSTAS CR√çTICAS
================================================================================

1. ‚úÖ Nome correto: UnidadeDeConsumo (n√£o "Conta")
2. ‚úÖ Endpoints existem (com ajustes de nomenclatura)
3. ‚úÖ Estados financeiros: StatusFinanceiroPedido (NAO_PAGO, PAGO, ESTORNADO)
4. ‚úÖ Estrutura JSON: Fornecida neste documento
5. ‚úÖ D√©bito autom√°tico: Funciona ao criar pedido PRE_PAGO
6. ‚úÖ Pagamento manual: PUT /api/pedidos/{id}/confirmar-pagamento
7. ‚úÖ P√≥s-pago: isPosPagoAtivo() no service (sem endpoint REST)
8. ‚úÖ Valida√ß√µes: Confirmadas neste documento


================================================================================
17. PR√ìXIMOS PASSOS RECOMENDADOS
================================================================================

IMEDIATO (Equipe Frontend):
1. Renomear servi√ßos e vari√°veis (Conta ‚Üí UnidadeDeConsumo)
2. Atualizar endpoints conforme se√ß√£o 10.2
3. Implementar c√°lculo de resumo financeiro (se√ß√£o 14.3)
4. Ajustar enums conforme se√ß√£o 10.4
5. Testar integra√ß√£o com backend real

CURTO PRAZO (Ambas Equipes):
1. Validar casos de uso completos
2. Testar fluxo de erro
3. Documentar exce√ß√µes adicionais
4. Criar testes E2E de integra√ß√£o

M√âDIO PRAZO (Backend):
1. Criar endpoint GET /api/config/pos-pago (se necess√°rio)
2. Adicionar filtro ?unidadeConsumoId em GET /api/pedidos
3. Implementar auditoria financeira completa
4. Adicionar m√©tricas e dashboards


================================================================================
18. CONTATO E SUPORTE
================================================================================

D√öVIDAS ADICIONAIS:
- Consultar documenta√ß√£o existente
- Verificar c√≥digo-fonte das entidades
- Testar via Swagger: http://localhost:8080/swagger-ui.html
- Analisar logs do servidor em caso de erro

AMBIENTE DE TESTES:
- Servidor: http://localhost:8080
- Swagger: http://localhost:8080/swagger-ui.html
- Health Check: http://localhost:8080/actuator/health


================================================================================
FIM DA RESPOSTA
================================================================================

Esperamos que este documento esclare√ßa todas as d√∫vidas levantadas.
A equipe de backend est√° √† disposi√ß√£o para suporte adicional durante a integra√ß√£o.

Boa implementa√ß√£o! üöÄ
